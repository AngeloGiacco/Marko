(this.webpackJsonpmarko=this.webpackJsonpmarko||[]).push([[0],{122:function(e,t,n){e.exports=n(370)},127:function(e,t,n){},142:function(e,t,n){},144:function(e,t,n){},368:function(e,t,n){},370:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(15),o=n.n(c),s=(n(127),n(22)),u=n(116),i=n(39),l=(n(136),n(138),n(371),i.apps.length?i.app():i.initializeApp({apiKey:"AIzaSyBIL9Ladlachak0hxP1OqJdNyLr2vOpCUc",authDomain:"marko-d2fc5.firebaseapp.com",databaseURL:"https://marko-d2fc5.firebaseio.com",projectId:"marko-d2fc5",storageBucket:"marko-d2fc5.appspot.com",messagingSenderId:"1071704516007",appId:"1:1071704516007:web:e85179cc21cee9a4064282"})),d=l.auth(),f={googleProvider:new i.auth.GoogleAuthProvider},m=l.firestore(),p=l.storage(),h=(n(142),Object(u.a)({providers:f,firebaseAppAuth:d})((function(e){var t=e.signInWithGoogle,n=e.signOut,a=e.user;return r.a.createElement(r.a.Fragment,null,r.a.createElement("header",{className:"header"},r.a.createElement("h2",null,"Marko"),a&&r.a.createElement("div",{className:"user-profile"},r.a.createElement("a",{className:"log-out-link",href:"#log-out",onClick:function(){console.log("Signed out..."),n()}},"Log Out"),r.a.createElement("img",{alt:"Profile",className:"avatar",src:a.photoURL}))),r.a.createElement(s.b,null,r.a.createElement(C,{path:"/",user:a,signIns:{signInWithGoogle:t}}),r.a.createElement(x,{path:"user/:userId",user:a}),r.a.createElement(S,{path:"user/:userId/editor/:fileId",user:a})))}))),b=n(16),g=n(12),v=n.n(g),E=n(21),w=n(28),k=(n(144),function(){var e=Object(E.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.collection("users").doc(t).get();case 2:if(!(n=e.sent).exists){e.next=13;break}return console.log("User found in database"),e.next=7,m.collection("users").doc(n.id).collection("files").get();case 7:return a=e.sent,r=[],a.forEach((function(e){var t=e.data(),n=t.name,a=t.content;r.push({id:e.id,name:n,content:a})})),e.abrupt("return",r);case 13:return console.log("User not found in database, creating new entry..."),m.collection("users").doc(t).set({}),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),O=function(){var e=Object(E.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.collection("users").doc(t).collection("files").add({name:n,content:""});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=Object(E.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.collection("users").doc(t).collection("files").doc(n).delete();case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(e){var t=e.user,n=e.userId,c=Object(a.useState)(""),o=Object(b.a)(c,2),u=o[0],i=o[1],l=Object(w.a)(n,k),d=l.data,f=l.error;return Object(a.useEffect)((function(){t||Object(s.c)("/")}),[t]),f?(console.log(f),r.a.createElement("p",null,"[Error loading data!]")):d?r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),u&&(i(""),O(n,u),Object(w.b)(n))},className:"new-file-form"},r.a.createElement("input",{type:"text",placeholder:"Your new files name...",value:u,onChange:function(e){return i(e.target.value)}}),r.a.createElement("button",{type:"submit",className:"add-button"},"Create")),r.a.createElement("ul",{className:"files-list"},d.map((function(e){return r.a.createElement("li",{key:e.id,className:"file"},r.a.createElement(s.a,{to:"/user/".concat(n,"/editor/").concat(e.id),className:"link"},e.name),r.a.createElement("button",{onClick:function(){j(n,e.id).then((function(){return Object(w.b)(n)}))},className:"delete-button"},"x"))})))):r.a.createElement("p",null,"Loading...")},I=n(118),N=n.n(I),y=n(45),L=(n(368),n(369),function(){var e=Object(E.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.collection("users").doc(t).collection("files").doc(n).get();case 2:return a=e.sent,e.abrupt("return",a.data());case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),S=function(e){var t=e.user,n=e.userId,c=e.fileId;Object(a.useEffect)((function(){t||Object(s.c)("/")}),[t]);var o=Object(w.a)([n,c],L),u=o.data,i=o.error,l=Object(a.useState)(null),d=Object(b.a)(l,2),f=d[0],h=d[1];Object(a.useEffect)((function(){void 0!==u&&null===f&&(console.log("Set initial content"),h(u.content))}),[u,f]);var g=function(e){return e.preventDefault(),e.returnValue="You have unsaved changes!","You have unsaved changes!"};Object(a.useEffect)((function(){return u&&u.content!==f?window.addEventListener("beforeunload",g):window.removeEventListener("beforeunload",g),function(){return window.removeEventListener("beforeunload",g)}}));var k=function(){var e=Object(E.a)(v.a.mark((function e(t){var a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t.size>=1e6)){e.next=8;break}return e.next=3,m.collection("users").doc(n).collection("images").add({name:t.name});case 3:return a=e.sent,e.next=6,p.ref().child("users/".concat(n,"/").concat(a.id,"-").concat(t.name)).put(t);case 6:return r=e.sent,e.abrupt("return",r.ref.getDownloadURL());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return i?r.a.createElement("p",null,"We had an issue while getting the data"):u?r.a.createElement("div",null,r.a.createElement("header",{className:"editor-header"},r.a.createElement(s.a,{className:"back-button",to:"/user/".concat(n)},"<"),r.a.createElement("h3",null,u.name),r.a.createElement("button",{disabled:u.content===f,onClick:function(){m.collection("users").doc(n).collection("files").doc(c).update({content:f}),Object(w.b)([n,c]),y.b.success("\ud83c\udf89 Your changes have been saved!")},className:"save-button"},"Save Changes")),r.a.createElement("div",{className:"editor"},r.a.createElement(N.a,{defaultValue:u.content,onChange:function(e){h(e())},uploadImage:k,onShowToast:function(e){return Object(y.b)(e)}})),r.a.createElement(y.a,null)):r.a.createElement("p",null,"Loading...")},C=function(e){var t=e.user,n=e.signIns.signInWithGoogle;return Object(a.useEffect)((function(){t&&Object(s.c)("/user/".concat(t.uid))}),[t]),r.a.createElement("div",{className:"sign-in-page"},r.a.createElement("h3",null,"Welcome to Marko a simple & beautiful online markdown editor for taking notes"),r.a.createElement("p",null,"Sign in with your social accounts to have files that are synced accross devices"),r.a.createElement("div",{className:"sign-in-buttons"},r.a.createElement("button",{onClick:n},"Sign in with Google")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(h,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[122,1,2]]]);
//# sourceMappingURL=main.8650df10.chunk.js.map